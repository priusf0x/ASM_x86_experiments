Turbo Assembler	 Version 4.1	    02/08/26 23:39:49	    Page 1
state_ma.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100h
      4
      5				     ; ======================= DEFINES =========================
      6
      7				     __exit__ macro
      8						     mov ah, 4ch
      9						     int 21h
     10					      endm
     11
     12	      =0024		     EOL     equ "$"
     13
     14				     ; uses dx ah
     15				     PRINT macro string
     16					     lea dx, [string]
     17					     mov ah, 09h
     18					     int 21h
     19					   endm
     20
     21
     22				     ; uses dl ah al
     23				     GETCH macro
     24					     mov ah, 08h
     25					     int 21h
     26					   endm
     27
     28				     ; ========================= MAIN ==========================
     29
     30	0100			     _start:
     31	0100  E8 0004				     call state_machine
     32						     __exit__
1    33	0103  B4 4C				     mov ah, 4ch
1    34	0105  CD 21				     int 21h
     35
     36				     ; ====================== FUNCTIONS	========================
     37
     38	0107			     state_machine:
     39
     40	0107			     .repeat:
     41					     GETCH
1    42	0107  B4 08			     mov ah, 08h
1    43	0109  CD 21			     int 21h
     44	010B  74 27			     jz	.leave			     ; LEAVE IF	EMPTY
     45	010D  2C 30			     sub al, 48			     ; CONVERSATION TO NUMBER
     46	010F  8A 1E 0004r		     mov bl, [.msg_count]
     47	0113  3A C3			     cmp al, bl			     ; CHECK IF	CORRECT
     48	0115  76 09			     jbe .err_skip		     ; LEAVE IF	INCORRECT
     49					     PRINT .err_msg
1    50	0117  BA 0005r			     lea dx, [.err_msg]
1    51	011A  B4 09			     mov ah, 09h
1    52	011C  CD 21			     int 21h
     53	011E  EB E7			     jmp .repeat
     54	0120			     .err_skip:
     55	0120  84 C0			     test al, al		     ; ZERO TEST
     56	0122  74 10			     jz	.leave			     ; LEAVE BY	DEFAULT
     57
Turbo Assembler	 Version 4.1	    02/08/26 23:39:49	    Page 2
state_ma.asm



     58	0124  33 DB			     xor bx, bx
     59	0126  8A D8			     mov bl, al
     60	0128  D0 E3			     shl bl, 1
     61	012A  8B 97 0000r		     mov dx, [bx + offset .states]
     62	012E  B4 09			     mov ah, 09h
     63	0130  CD 21			     int 21h
     64
     65	0132  EB D3			     jmp .repeat
     66
     67	0134				     .leave:
     68						     PRINT .exit_msg
1    69	0134  BA 001Dr			     lea dx, [.exit_msg]
1    70	0137  B4 09			     mov ah, 09h
1    71	0139  CD 21			     int 21h
     72	013B  C3				     ret
     73
     74
     75	013C				     .data
     76					     align 2
     77	0000			     .states:
     78	0000  001Dr				     dw	.exit_msg
     79	0002  0028r				     dw	.svetloye
     80	0004  01		     .msg_count	     db	1
     81
     82	0005			     .text:
     83	0005  8D A5 AF E0 A0 A2	A8+  .err_msg	     db	"Неправильное значение!", 10, EOL
     84	      AB EC AD AE A5 20	A7+
     85	      AD A0 E7 A5 AD A8	A5+
     86	      21 0A 24
     87	001D  82 E1 A5 20 AF AE	AA+  .exit_msg	     db	"Все пока!", 10, EOL
     88	      A0 21 0A 24
     89	0028  82 20 E6 A5 AB AE	AC+  .svetloye	     db	"В целом сойдет", 10, EOL
     90	      20 E1 AE A9 A4 A5	E2+
     91	      0A 24
     92	0038				     .code
     93
     94
     95
     96
     97				     end	     _start
Turbo Assembler	 Version 4.1	    02/08/26 23:39:49	    Page 3
Symbol Table




Symbol Name			  Type	 Value

.ERR_MSG			  Byte	 DGROUP:0005
.ERR_SKIP			  Near	 DGROUP:0120
.EXIT_MSG			  Byte	 DGROUP:001D
.LEAVE				  Near	 DGROUP:0134
.MSG_COUNT			  Byte	 DGROUP:0004
.REPEAT				  Near	 DGROUP:0107
.STATES				  Near	 DGROUP:0000
.SVETLOYE			  Byte	 DGROUP:0028
.TEXT				  Near	 DGROUP:0005
??DATE				  Text	 "02/08/26"
??FILENAME			  Text	 "state_ma"
??TIME				  Text	 "23:39:49"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 STATE_MA
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
EOL				  Number 0024
STATE_MACHINE			  Near	 DGROUP:0107
_START				  Near	 DGROUP:0100

Macro Name

GETCH
PRINT
__EXIT__

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0038 Word	  Public  DATA
  _TEXT				  16  013C Word	  Public  CODE
