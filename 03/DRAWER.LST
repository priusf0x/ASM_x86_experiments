Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 1
drawer.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     .286
      4				     org 100h
      5				     locals @@
      6
      7				     include macros.asm
1     8				     ; ======================= MACROS ==========================
1     9
1    10				     __exit__	 macro
1    11						     mov ah, 4ch
1    12						     int 21h
1    13						 endm
     14
     15				     ; ====================== ATRIBUTES	========================
     16
     17	      =0001		     FG_BLUE	     equ 00000001b
     18	      =0002		     FG_GREEN	     equ 00000010b
     19	      =0004		     FG_RED	     equ 00000100b
     20	      =0008		     FG_BRIGHT	     equ 00001000b
     21
     22	      =000F		     FG_WHITE	     equ FG_BLUE xor FG_GREEN xor FG_RED xor FG_BRIGHT
     23
     24	      =0010		     BG_BLUE	     equ 00010000b
     25	      =0020		     BG_GREEN	     equ 00100000b
     26	      =0040		     BG_RED	     equ 01000000b
     27	      =0080		     BG_BLINK	     equ 10000000b
     28
     29	      =0070		     BG_WHITE	     equ BG_BLUE xor BG_GREEN xor BG_RED
     30
     31				     ; ======================= HELPERS =========================
     32
     33	      =B800		     VRAM_LOCATION   equ 0B800h
     34	      =0028		     CENTER_X	     equ 40
     35	      =000D		     CENTER_Y	     equ 13
     36	      =002F		     SEPARATOR	     equ '/'
     37	      =00A0		     NEW_LINE_OFFSET equ 160
     38
     39	*100			     rect_style	     struc
     40	*000  01*(??)					     global_filling  db	?
     41	*001  01*(??)					     global_style    db	?
     42	*002  01*(??)					     global_atribute db	?
     43	*003					     ends
     44
     45	*100			     rect_filling    struc
     46	*000  01*(??)					     filling_ul	db ?
     47	*001  01*(??)					     filling_u	db ?
     48	*002  01*(??)					     filling_ur	db ?
     49	*003  01*(??)					     filling_ml	db ?
     50	*004  01*(??)					     filling_m	db ?
     51	*005  01*(??)					     filling_mr	db ?
     52	*006  01*(??)					     filling_dl	db ?
     53	*007  01*(??)					     filling_d	db ?
     54	*008  01*(??)					     filling_dr	db ?
     55	*009					     ends
     56
     57				     ; =========================================================
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 2
drawer.asm



     58
     59	0100			     __start__:
     60
     61						     ;mov cl, ds:[bx + 80h]
     62						     ;mov ax, VRAM_LOCATION
     63						     ;mov es, ax
     64						     ;xor di, di
     65						     ;mov si, 81h
     66						     ;
     67						     ;call write_text_centered
     68
     69	0100  8A 8F 0080			     mov cl, ds:[bx + 80h]
     70	0104  B8 B800				     mov ax, VRAM_LOCATION
     71	0107  8E C0				     mov es, ax
     72	0109  B8 1004				     mov ax, 1004h
     73	010C  BB 2002				     mov bx, 2002h
     74	010F  BA 1003				     mov dx, 1003h
     75	0112  B9 0000				     mov cx, 00h
     76	0115  BF 0140				     mov di, 320
     77
     78	0118  E8 007B				     call draw_frame_line
     79
     80						     __exit__
1    81	011B  B4 4C				     mov ah, 4ch
1    82	011D  CD 21				     int 21h
     83
     84	011F			     .data
     85	0000  0081		     command_line    dw	81h
     86	0002  10 20 40		     FRAME_STYLE     rect_style	<BG_BLUE, BG_GREEN, BG_RED>
     87	0005  2B 2D 2B 7C 20 7C	2B+  FILLING	     rect_filling <43d,45d,43d,124d,32d,124d,43d,45d,43d>
     88	      2D 2B
     89	000E			     STYLES:
     90	000E  10 20 10		     STYLE_0	     rect_style	<BG_BLUE, BG_GREEN, BG_BLUE>
     91	0011  40 70 10		     STYLE_1	     rect_style	<BG_RED	, BG_WHITE, BG_BLUE>
     92	0014  00 70 0F		     STYLE_2	     rect_style	<      0, BG_WHITE, FG_WHITE>
     93
     94				     ; ======================= FUNCTIONS ========================
     95
     96	0017			     .code
     97
     98				     ; ==================== STRING FUNCTION =====================
     99
    100				     ;;ds:si - command line ptr
    101				     ;set_style:
    102				     ;
    103				     ;		      xor ax, ax
    104				     ;		      mov al, [si]
    105				     ;		      sub ax, "0"
    106				     ;		      mov bx, ax
    107				     ;		      shl ax, 1
    108				     ;		      add bx, ax
    109				     ;		      lea bx, [bx + offset STYLES]
    110				     ;
    111				     ;		      mov al, [bx]
    112				     ;		      mov FRAME_STYLE.global_filling, al
    113				     ;
    114				     ;		      mov al, [bx + 1]
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 3
drawer.asm



    115				     ;		      mov FRAME_STYLE.global_style, al
    116				     ;
    117				     ;		      mov al, [bx + 2]
    118				     ;		      mov FRAME_STYLE.global_atribute, al
    119				     ;
    120				     ;		      inc si
    121				     ;		      mov bx, offset FILLING
    122				     ;		      mov cx, 9h
    123				     ;@@set_param:
    124				     ;		      mov al, [si]
    125				     ;		      mov [bx],	al
    126				     ;		      inc si
    127				     ;		      inc bx
    128				     ;		      loop @@set_param
    129
    130				     ;		      ret
    131
    132				     ; _________________________________________________________
    133				     ; Skip Spaces until not space symbol
    134				     ;
    135				     ; args:
    136				     ;	     es:di - input string
    137				     ;	     cx	   - string length
    138				     ;
    139				     ; return:
    140				     ;	     di	- skipped until	separator
    141				     ;	     ci	- si string length
    142				     ; delete:
    143				     ;	     al
    144				     ; _________________________________________________________
    145
    146	011F			     skip_spaces:
    147
    148	011F  FC				     cld
    149
    150	0120  B0 20				     mov al, 20h
    151	0122  F3> AE				     repe scasb
    152
    153	0124  C3				     ret
    154
    155				     ; _________________________________________________________
    156
    157				     ; _________________________________________________________
    158				     ; Returns length of rhe ds:si string with separator
    159				     ;	     symbol
    160				     ; args:
    161				     ;	     es:di - input string
    162				     ;	     cx	   - string length
    163				     ; return:
    164				     ;	     bx	- string length
    165				     ;	     di	- skipped until	separator or EOL
    166				     ;	     cx	- length of new	si string
    167				     ; delete
    168				     ;	     ax
    169				     ; _________________________________________________________
    170
    171	0125			     strlen:
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 4
drawer.asm



    172
    173	0125  8B D9				     mov bx, cx
    174	0127  85 C9				     test cx, cx
    175	0129  74 0B				     jz	@@skip
    176
    177	012B  33 C0				     xor ax, ax
    178
    179	012D  FC				     cld
    180
    181	012E  B0 2F				     mov al, separator
    182	0130  F2> AE				     repne scasb
    183
    184	0132  75 02				     jne @@skip
    185	0134  41				     inc cx
    186	0135  4F				     dec di
    187
    188	0136			     @@skip:
    189	0136  2B D9				     sub bx, cx
    190	0138			     @@leave:
    191	0138  C3				     ret
    192
    193				     ; _________________________________________________________
    194
    195				     ; _________________________________________________________
    196				     ; Count amount of al(ASCII) symbols in string es:al
    197				     ;
    198				     ; args:
    199				     ;	     al	   - symbol
    200				     ;	     es:si - input string
    201				     ;	     cx	   - string length
    202				     ;
    203				     ; return:
    204				     ;
    205				     ;	     si	- skipped until	EOL
    206				     ;	     cx	- ds:si	string length
    207				     ;	     dx	- symbol amount
    208				     ; _________________________________________________________
    209
    210	0139			     count_al_symbols_in_string:
    211
    212	0139  33 D2				     xor dx, dx
    213	013B  FC				     cld
    214
    215	013C			     @@continue:
    216
    217	013C  F2> AE				     repne scasb
    218	013E  74 01				     je	@@increment
    219
    220	0140  C3				     ret
    221
    222	0141			     @@increment:
    223	0141  42				     inc dx
    224	0142  46				     inc si
    225	0143  EB F7				     jmp @@continue
    226
    227				     ; _________________________________________________________
    228				     ; Translates bx into string offset
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 5
drawer.asm



    229				     ;
    230				     ; args:
    231				     ;	     bx	- string number
    232				     ;
    233				     ; return:
    234				     ;	     bx	- new offset
    235				     ; del
    236				     ;	     ax
    237				     ; _________________________________________________________
    238
    239	0145			     translate_string:
    240
    241	0145  8B C3				     mov ax, bx
    242	0147  D1 E3				     shl bx, 1
    243	0149  C1 E0 03				     shl ax, 3
    244	014C  03 D8				     add bx, ax		     ; si * 10
    245	014E  C1 E3 04				     shl bx, 4		     ; si * 16
    246
    247	0151  C3				     ret
    248
    249				     ; _________________________________________________________
    250
    251				     ; _________________________________________________________
    252				     ; Write ds:si line	with ah:al indent with offset es:si
    253				     ;
    254				     ; args:
    255				     ;	     cx	   - printable string length
    256				     ;	     es:di - offset
    257				     ;	     ds:si - source
    258				     ; returns:
    259				     ;	     si	- the next symbol after	last written
    260				     ;
    261				     ; delete:
    262				     ;	     di, cx
    263				     ; _________________________________________________________
    264
    265	0152			     write_line:
    266
    267	0152  85 C9				     test cx, cx
    268	0154  74 09				     jz	@@leave
    269
    270	0156  FC				     cld
    271	0157  8A 26 0004r			     mov ah, FRAME_STYLE.global_atribute
    272
    273	015B  AC		     @@scope:	     lodsb
    274	015C  AB				     stosw
    275	015D  E2 FC				     loop @@scope
    276	015F			     @@leave:
    277
    278	015F  C3				     ret
    279
    280				     ; _________________________________________________________
    281				     ; Write string with centering
    282				     ;
    283				     ; args:
    284				     ;	     cx	   - string length
    285				     ;	     es:di - start_line	offset
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 6
drawer.asm



    286				     ;	     ds:si - source
    287				     ; returns:
    288				     ;	     si	- the next symbol after	last written
    289				     ;
    290				     ; delete:
    291				     ;	     di, cx, bx
    292				     ; _________________________________________________________
    293
    294	0160			     write_string_centered:
    295
    296	0160  83 C7 50				     add di, CENTER_X *	2
    297	0163  2B F9				     sub di, cx
    298
    299	0165  83 E7 FE				     and di, 0FFFFh - 1
    300
    301	0168  E8 FFE7				     call write_line
    302
    303	016B  C3				     ret
    304				     ; _________________________________________________________
    305
    306				     ; _________________________________________________________
    307				     ; Write text with centering
    308				     ;
    309				     ; args:
    310				     ;	     cx	   - string length
    311				     ;	     es:di - start_line	offset
    312				     ;	     ds:si - source
    313				     ;
    314				     ; delete:
    315				     ;	     ax, bx, cx, dx, di, si
    316				     ; _________________________________________________________
    317
    318	016C			     write_text_centered:
    319
    320	016C			     @@scope:
    321
    322	016C  51				     push cx
    323	016D  57				     push di
    324	016E  06				     push es
    325
    326	016F  8C D8				     mov ax, ds
    327	0171  8E C0				     mov es, ax
    328	0173  8B FE				     mov di, si
    329
    330	0175  E8 FFAD				     call strlen
    331
    332	0178  07				     pop es
    333	0179  5F				     pop di
    334	017A  59				     pop cx
    335
    336	017B  2B CB				     sub cx, bx
    337
    338	017D  51				     push cx
    339	017E  57				     push di
    340
    341	017F  8B CB				     mov cx, bx
    342	0181  E8 FFDC				     call write_string_centered
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 7
drawer.asm



    343
    344	0184  5F				     pop di
    345	0185  59				     pop cx
    346
    347	0186  81 C7 00A0			     add di, NEW_LINE_OFFSET
    348
    349	018A  85 C9				     test cx, cx
    350	018C  75 01				     jnz @@decrease
    351
    352	018E  C3				     ret
    353
    354	018F			     @@decrease:
    355	018F  46				     inc si
    356	0190  49				     dec cx
    357	0191  EB D9				     jmp @@scope
    358
    359				     ; _________________________________________________________
    360
    361				     ; ==================== DRAW_FUNCTION ======================
    362
    363				     ; _________________________________________________________
    364				     ; Draws horizontal	line with length of cx on es:di	offset
    365				     ;
    366				     ; args:
    367				     ;	     ah	   - atribute
    368				     ;	     al	   - ASCII character
    369				     ;	     cx	   - string length
    370				     ;	     es:di - start point offset
    371				     ;
    372				     ; returns:
    373				     ;	     di	- new cursor position
    374				     ;
    375				     ; delete:
    376				     ;	     cx
    377				     ; _________________________________________________________
    378
    379	0193			     draw_horizontal:
    380
    381	0193  F3> AB				     rep stosw
    382
    383	0195  C3				     ret
    384
    385				     ; _________________________________________________________
    386				     ; Draws horizontal	line() with length of cx on es:di offset
    387				     ;
    388				     ; args:
    389				     ;1st symbol:    ah	   - atribute
    390				     ;		     al	   - ASCII character
    391				     ;2st symbol:    bh	   - atribute
    392				     ;		     bl	   - ASCII character
    393				     ;3st symbol:    dh	   - atribute
    394				     ;		     dl	   - ASCII character
    395				     ;
    396				     ;		     cx	   - string length
    397				     ;		     es:di - start point offset
    398				     ;
    399				     ; delete:
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 8
drawer.asm



    400				     ;	     ax, bx, cx, di
    401				     ; _________________________________________________________
    402
    403	0196			     draw_frame_line:
    404
    405	0196  51				     push cx
    406	0197  B9 0001				     mov cx, 1
    407	019A  E8 FFF6				     call draw_horizontal
    408
    409	019D  59				     pop cx
    410	019E  8B C3				     mov ax, bx
    411	01A0  E8 FFF0				     call draw_horizontal
    412
    413	01A3  B9 0001				     mov cx, 1
    414	01A6  8B C2				     mov ax, dx
    415	01A8  E8 FFE8				     call draw_horizontal
    416
    417	01AB  C3				     ret
    418				     ; _________________________________________________________
    419
    420				     ; _________________________________________________________
    421				     ; Draws a frame
    422				     ;
    423				     ; args:
    424				     ;		     ch	- height
    425				     ;		     cl	- length
    426				     ;		     es:di - start point offset
    427				     ;
    428				     ; delete:
    429				     ;	     ax, bx, cx, dx, di, si
    430				     ; _________________________________________________________
    431
    432	01AC			     draw_frame:
    433
    434
    435
    436	01AC  C3				     ret
    437
    438				     ; _________________________________________________________
    439
    440
    441				     end __start__
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 9
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/12/26"
??FILENAME			  Text	 "drawer  "
??TIME				  Text	 "17:26:51"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@CONTINUE			  Near	 DGROUP:013C
@@DECREASE			  Near	 DGROUP:018F
@@INCREMENT			  Near	 DGROUP:0141
@@LEAVE				  Near	 DGROUP:0138
@@LEAVE				  Near	 DGROUP:015F
@@SCOPE				  Near	 DGROUP:015B
@@SCOPE				  Near	 DGROUP:016C
@@SKIP				  Near	 DGROUP:0136
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0707H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 DRAWER
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BG_BLINK			  Number 0080
BG_BLUE				  Number 0010
BG_GREEN			  Number 0020
BG_RED				  Number 0040
BG_WHITE			  Number 0070
CENTER_X			  Number 0028
CENTER_Y			  Number 000D
COMMAND_LINE			  Word	 DGROUP:0000
COUNT_AL_SYMBOLS_IN_STRING	  Near	 DGROUP:0139
DRAW_FRAME			  Near	 DGROUP:01AC
DRAW_FRAME_LINE			  Near	 DGROUP:0196
DRAW_HORIZONTAL			  Near	 DGROUP:0193
FG_BLUE				  Number 0001
FG_BRIGHT			  Number 0008
FG_GREEN			  Number 0002
FG_RED				  Number 0004
FG_WHITE			  Number 000F
FILLING				  Struct DGROUP:0005 RECT_FILLING
FRAME_STYLE			  Struct DGROUP:0002 RECT_STYLE
NEW_LINE_OFFSET			  Number 00A0
SEPARATOR			  Number 002F
SKIP_SPACES			  Near	 DGROUP:011F
STRLEN				  Near	 DGROUP:0125
STYLES				  Near	 DGROUP:000E
STYLE_0				  Struct DGROUP:000E RECT_STYLE
STYLE_1				  Struct DGROUP:0011 RECT_STYLE
STYLE_2				  Struct DGROUP:0014 RECT_STYLE
TRANSLATE_STRING		  Near	 DGROUP:0145
VRAM_LOCATION			  Number B800
WRITE_LINE			  Near	 DGROUP:0152
Turbo Assembler	 Version 4.1	    02/12/26 17:26:51	    Page 10
Symbol Table



WRITE_STRING_CENTERED		  Near	 DGROUP:0160
WRITE_TEXT_CENTERED		  Near	 DGROUP:016C
__START__			  Near	 DGROUP:0100

Macro Name

__EXIT__

Structure Name			  Type	Offset

RECT_FILLING
 FILLING_UL			  Byte	 0000
 FILLING_U			  Byte	 0001
 FILLING_UR			  Byte	 0002
 FILLING_ML			  Byte	 0003
 FILLING_M			  Byte	 0004
 FILLING_MR			  Byte	 0005
 FILLING_DL			  Byte	 0006
 FILLING_D			  Byte	 0007
 FILLING_DR			  Byte	 0008
RECT_STYLE
 GLOBAL_FILLING			  Byte	 0000
 GLOBAL_STYLE			  Byte	 0001
 GLOBAL_ATRIBUTE		  Byte	 0002

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0017 Word	  Public  DATA
  _TEXT				  16  01AD Word	  Public  CODE
